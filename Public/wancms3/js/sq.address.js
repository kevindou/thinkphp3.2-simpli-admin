!function(a,b){var c,d,e,f=b.Class(b.Widget);f.include({version:"0.0.2",template:"<option {selected} value='{value}'>{name}</option>",options:{city:{selector:"",def:"",height:300},district:{selector:"",def:"",height:300},province:{selector:"",def:"",height:300},firstOption:"请选择",url:"http://my.37wan.com/controller/user/addressinfo.php"},data:{},init:function(b){var c=this.options=a.extend(!0,this.options,b);return null===c.province||null===c.city?alert("缺少省市 select"):(a.each(["province","city","district"],function(b,d){c[d].element=c[d].selector.fn&&c[d].fn.selector.jquery?c[d].selector:a(c[d].selector)}),this._init(),void 0)},_init:function(){this.options.city.element.html("<option value=''>先选省</option>"),this.options.district.element.length&&this.options.district.element.html("<option value=''>先选市</option>"),this._parseProvince()},_parseProvince:function(){var b=this;a.get(b.options.url,function(a){1===a.code?(c=a.data,b.__parseProvince()):alert(a.msg)},"jsonp").fail(function(){alert("获取数据失败，请稍后尝试")})},__parseProvince:function(){this.options.province.element.html(this._parseTemplate(c,"province")),this._parseSelectMenu()},_parseSelectMenu:function(){var a=this;this.menuPR=new b.Selectmenu(this.options.province),this.menuPR.bind("change",function(b){a._parseCity(b.value);var c=a.options.city.element.val();!a.menuDI.element.length||a.menuDI.options.disabled||c||a.__parseDistrict("")}),this.menuCI=new b.Selectmenu(this.options.city),this.menuCI.disable(),this.menuCI.bind("change",function(b){a._parseDistrict(b.value),a.menuDI.options.disabled&&a.menuDI.enable()}),this.options.district.element.length&&(this.menuDI=new b.Selectmenu(this.options.district),this.menuDI.disable());var d=this.options.province.def;d&&this._parseCity(this._getCodeByName(d,c))},_parseCity:function(b){var c=this;d?c.__parseCity(b):a.get(this.options.url,{type:"city"},function(a){1===a.code?(d=a.data,c.__parseCity(b)):alert(a.msg)},"jsonp").fail(function(){alert("获取数据（市）失败，请稍后再试")})},__parseCity:function(b){var c=""===b?"<option value=''>先选省</option>":this._parseTemplate(this._findCity(b),"city");this.options.city.element.html(c),this._isIE6()&&setTimeout(a.proxy(function(){this.options.city.element.show().hide()},this),10),this.menuCI.options.disabled&&this.menuCI.enable(),this.menuCI.refresh();var e=this.options.city.def,f=this.options.city.element.val();f?this._parseDistrict(f):e&&this._parseDistrict(this._getCodeByName(e,d))},_findCity:function(a){for(var b=0,c=d.length,e=[];c>b;b++)d[b].CODE.substring(0,2)===a.substring(0,2)&&e.push(d[b]);return e},_parseDistrict:function(b){var c=this;e?c.__parseDistrict(b):a.get(this.options.url,{type:"area"},function(a){1===a.code?(e=a.data,c.__parseDistrict(b)):alert(a.msg)},"jsonp").fail(function(){alert("获取数据（区）失败，请稍后再试")})},__parseDistrict:function(b){var c=""===b?"<option value=''>先选市</option>":this._parseTemplate(this._findDistrict(b),"district");this.options.district.element.html(c),this._isIE6()&&setTimeout(a.proxy(function(){this.options.district.element.show().hide()},this),10),this.menuDI.options.disabled&&this.menuDI.enable(),this.menuDI.refresh()},_findDistrict:function(a){for(var b=0,c=e.length,d=[];c>b;b++)e[b].CODE.substring(0,4)===a.substring(0,4)&&d.push(e[b]);return d},_isSelected:function(a,b){var c=this.options[b].def;return!!c&&a.indexOf(c)>-1},_parseTemplate:function(a,b){var c=a.length,d=0,e=[],f=this.options.firstOption;for(f&&e.push("<option value=''>"+f+"</option>");c>d;d++)e.push(this.template.replace("{value}",a[d].CODE).replace("{selected}",this._isSelected(a[d].NAME,b)?"selected":0===d&&"city"===b?"selected":"").replace("{name}",a[d].NAME));return e.join("")},_getCodeByName:function(a,b){for(var c=0,d=b.length;d>c;c++)if(b[c].NAME.indexOf(a)>-1)return b[c].CODE;return""},getAddress:function(b,c){b=b||" ";var d=[],e=this;return a.each(["province","city","district"],function(a,b){c?d.push(e.options[b].element.val()):d.push(e.options[b].element.find(":checked").text())}),d.join(b)},_isIE6:function(){return a.browser.msie&&"6.0"==a.browser.version}}),b.Address=f}(jQuery,SQ);