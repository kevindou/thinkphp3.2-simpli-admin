!function(a,b){var c=[],d=new b.Class(b.Widget);d.include({version:"0.0.2",win:a(window),doc:a(document),template:'<span class="sq-selectmenu"><input class="sq-selectmenu-input" type="text" /><a href="javascript:;" class="sq-selectmenu-btn"></a></span>',isOpen:!1,isRefresh:!1,eventNamespance:".sq.selectmenu",init:function(b){var d=this.options={element:a("select:first"),width:!1,height:200,disabled:!1,zIndex:0,position:{my:"left top",at:"left bottom",collision:"none"},animate:{open:"show",close:"hide"}};a.extend(this.options,b||{}),d.element.fn||(this.element=d.element=a(d.element)),this._parse(),this._drawMenu(),this._events(),c.push(this)},_parse:function(){this.element.hide(),this.wrap=a(this.template).insertAfter(this.element),this.text=this.wrap.find("input").outerWidth(this.options.width||this.element.outerWidth()),this.btn=this.wrap.find("a").attr("tabIndex","-1"),this._fillInput(),this.options.disabled&&this.disable()},_fillInput:function(){this.text.val(this.element.find("option:selected").text())},_drawMenu:function(){this.menu=a("<ul>",{"class":"sq-selectmenu-menu",width:this.text.outerWidth()-2}).appendTo(document.body),this.options.zIndex&&this.menu.css("z-index",this.options.zIndex)},_readOptions:function(b){var c=[];b.each(function(b,d){var e=a(d);c.push({element:e,index:b,value:e.attr("value"),label:e.text(),disabled:e.prop("disabled")})}),this.items=c},_renderMenu:function(b,c){var d=this;a.each(c,function(c,e){var f=a("<li>"),g=a("<a>",{href:"#",title:e.label}).data("sq-selectmenu-item",e);return e.disabled&&g.addClass("sq-selectmenu-item-disabled"),d._setText(g,e.label),e.a=g,f.append(g).appendTo(b)});var e=this.selectedIndex=this.element[0].selectedIndex;this.selectItem=this.menu.find("a:eq("+e+")").addClass("sq-selectmenu-menu-focus")},_setText:function(a,b){b?a.text(b):a.html("&#160;")},_events:function(){var b=this;b.wrap.on({"keypress.sq.selectmenu":function(a){9!==a.keyCode&&a.preventDefault()},"focusin.sq.selectmenu":function(){b.open()}},"input").on({"mouseenter.sq.selectmenu":function(){this.className.indexOf("focus")>-1||a(this).addClass("sq-selectmenu-btn-hover")},"mouseleave.sq.selectmenu":function(){a(this).removeClass("sq-selectmenu-btn-hover")},"click.sq.selectmenu":function(a){a.preventDefault(),b.isOpen?b.close():b.text.focus()}},"a"),b.doc.on("click"+b.eventNamespance,function(c){b.isOpen&&!a(c.target).closest(".sq-selectmenu, .sq-selectmenu-menu").length&&b.close()}),b.win.on("resize"+b.eventNamespance,function(){b.isOpen&&b.menu.position(a.extend(b.options.position,{of:b.wrap}))}),b.menu.on({"click.sq.selectmenu":function(c){if(c.preventDefault(),!(this.className.indexOf("disabled")>-1)){var d=a.data(this,"sq-selectmenu-item");b.select(d)}},"mouseenter.sq.selectmenu":function(){this.className.indexOf("focus")>-1||this.className.indexOf("disabled")>-1||a(this).addClass("sq-selectmenu-menu-hover")},"mouseleave.sq.selectmenu":function(){a(this).removeClass("sq-selectmenu-menu-hover")}},"a")},_destroying:function(){this.wrap.off().remove(),this.menu.off().remove(),this.doc.off(this.eventNamespance),this.win.off(this.eventNamespance),this.element.show()},_calHeight:function(){this.menu.css("maxHeight",this.options.height),this.doc[0].all&&!this.win[0].XMLHttpRequest&&(this.menu.height()>this.options.height?this.menu.height(this.options.height):this.menu.css("height","auto"))},refresh:function(a){this.menu.empty();var b=this.element.find("option");b.length&&(this._readOptions(b),this._renderMenu(this.menu,a||this.items),this._fillInput(),this.isRefresh=!0,this._isCalHeight=!1)},open:function(){if(!this.isOpen){if(this.isRefresh||this.refresh(),this._isCalHeight||(this._calHeight(),this._isCalHeight=!0),c.length>1)for(var b=0,d=c.length;d>b;b++)c[b].id!==this.id&&c[b].close();this.trigger("beforeOpen",this.menu),this.menu[this.options.animate.open]().position(a.extend(this.options.position,{of:this.wrap})),this.btn.addClass("sq-selectmenu-btn-focus"),this.isOpen=!0,this.scrollView(),this.trigger("open",this.menu)}},scrollView:function(a,b){if(this.selectedIndex&&(a=this.selectItem.parent().index()-1),!(0>=a)){var c=this.options.height,d=this.menu.find("li:first").outerHeight(),e=this.menu.children("li"),f=e.length*d;f>c&&this.menu.scrollTop(a*d),b&&!this.selectedIndex&&(this.tempSelectItem=e.eq(a+2).find("a").addClass("sq-selectmenu-menu-focus"))}},close:function(){this.menu[this.options.animate.close](),this.btn.removeClass("sq-selectmenu-btn-focus"),this.isOpen=!1,this.trigger("close")},select:function(a){if(a){var b=this.element[0].selectedIndex;this.selectedIndex=this.element[0].selectedIndex=a.index,this.text.val(a.label),this.selectItem&&this.selectItem.removeClass("sq-selectmenu-menu-focus"),this.tempSelectItem&&(this.tempSelectItem.removeClass("sq-selectmenu-menu-focus"),this.tempSelectItem=null),this.selectItem=this.menu.find("a:eq("+a.index+")").addClass("sq-selectmenu-menu-focus"),this.trigger("select",a),a.index!==b&&this.trigger("change",a),this.isOpen&&this.close()}},_toggleItemDisabled:function(a){var b=this.items[a];b.disabled?(b.element.prop("disabled",!1),b.disabled=!1,b.a.removeClass("sq-selectmenu-item-disabled")):(b.element.prop("disabled",!0),b.disabled=!0,b.a.addClass("sq-selectmenu-item-disabled"),b.a.hasClass("sq-selectmenu-menu-focus")&&(b.a.removeClass("sq-selectmenu-menu-focus"),this.element[0].selectedIndex=0,this.items[0].a.addClass("sq-selectmenu-menu-focus"),this.text[0].value=this.items[0].label))},toggleItemDiabled:function(b){if(a.isArray(b))for(var c=0,d=b.length;d>c;c++)this._toggleItemDisabled(b[c]);else this._toggleItemDisabled(b)},disable:function(){this.$disabled=a("<span class='sq-selectmenu-disabled'></span>").appendTo(this.wrap),this._isIE6()&&this.$disabled.css({width:this.wrap.width(),height:this.wrap.height()}),this.options.disabled=!0},enable:function(){this.$disabled&&(this.$disabled.remove(),delete this.$disabled,this.options.disabled=!1)},_isIE6:function(){return a.browser.msie&&"6.0"==a.browser.version}}),b.Selectmenu=d}(jQuery,SQ);