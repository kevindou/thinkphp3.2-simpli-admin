<style type="text/css">
    .mt-text span {padding-left: 10px;}
</style>
<div class="box-header">
    <h2><i class="icon-list"></i>管理员信息</h2>
</div>
<div class="box-content">
    <ul class="nav tab-menu nav-tabs" id="myTab">
        <li class="active"><a href="#messages">登录信息</a></li>
        <li><a href="#info">修改密码</a></li>
    </ul>

    <div id="myTabContent" class="tab-content">
        <div class="tab-pane" id="info">

        </div>
        <div class="tab-pane active" id="messages">
            <ul class="dashboard-list">
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-user blue"></i>
                            <span class="blue">账号</span>
                        </div>
                        <div class="span10 text-success">
                            {$users.name}
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-fire red"></i>
                            <span class="red">角色信息</span>
                        </div>
                        <div class="span10 text-success">
                            {$roles}
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-envelope-alt blue"></i>
                            <span class="blue">邮箱</span>
                        </div>
                        <div class="span10 text-success">
                            {$user.email}
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-picture blue"></i>
                            <span class="blue">头像</span>
                        </div>
                        <div class="span10" id="handlefile">
                            <img src="{$users.face}" class="file-select" style="width:160px; height:160px;">
                            <p class="red"> ( * 点击图片更换头像 ) </p>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-time red"></i>
                            <span class="red">注册时间</span>
                        </div>
                        <div class="span10 me-time">
                            {$user.create_time}
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-calendar blue"></i>
                            <span class="blue">上次登录时间</span>
                        </div>
                        <div class="span10 me-time">
                            {$user.last_time}
                        </div>
                    </div>
                </li>
                <li>
                    <div class="row-fluid">
                        <div class="span2 mt-text">
                            <i class="icon-coffee blue"></i>
                            <span class="blue">上次登录IP</span>
                        </div>
                        <div class="span10">
                            {$user.last_ip}
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function()
    {
        $('.me-time').each(function(){$(this).html(timeFormat(parseInt($(this).html()), "yyyy-MM-dd hh:mm:ss"))});

        // 文件上传
        var uploader = MeUpload('#handlefile', function(file, data){
            $('#handlefile img').attr('src', data.sPath);
            CutOutImage('#handlefile', file.id, data.sPath, [160, 160]);
        });
        uploader.init();

        // 取消图片裁剪
        $(document).on('click', '.me-cancel', function(){
            $(this).parentsUntil('.alert-info').slideUp(1000, function(){
                $(this).parent().parent().parent().remove().empty();
            });
        });

        // 图片裁剪处理
        $(document).on('click', '.me-clipping', function(){
            var f = $($(this).attr('form')),
                d = f.find('input');
            if (d.val() && ((d.attr('x') || d.attr('y')) && (d.attr('w') || d.attr('h') )))
            {
                var l = layer.load();
                $.ajax({
                    type:       "POST",
                    url:        f.attr('action'),
                    data:       {
                        x:      d.attr('x'), // 883842500055260387
                        y:      d.attr('y'),
                        w:      d.attr('w'),
                        h:      d.attr('h'),
                        path:   d.val()
                    },
                    dataType:   "json",
                }).always(function(){
                    layer.close(l)
                }).done(function(json){
                    if (json.status == 1)
                    {
                        $('#handlefile .alert-info').slideUp(1000, function() {
                            $(this).parent().remove().empty();
                            $('#handlefile img').attr('src', $('#handlefile img').attr('src') + '?time=' + Math.random());
                        });
                    } else {
                        $.gritter.add({
                            title:  "图片裁剪出现问题：",
                            text:   json.msg,
                            image:  "/Public/img/avatar.jpg",
                            sticky: false,
                            time:   "",
                        });
                    }

                }).fail(ajaxFail)
            } else {
                layer.msg('需要确定裁剪位置');
            }

            return false;
        })
    });

</script>